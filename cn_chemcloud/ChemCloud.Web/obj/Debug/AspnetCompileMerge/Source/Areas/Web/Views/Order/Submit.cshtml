@{
    ViewBag.Title = "购物车结算";
    Layout = "~/Areas/Web/Views/Shared/_OrderTopBar.cshtml";
}
@model IEnumerable<ChemCloud.Model.ShippingAddressInfo>
@using System;
@using System.Collections.Generic;
@using System.Linq;
@using System.Linq.Expressions;

<style>
    .btn-margain {
        width: 220px;
        height: 36px;
        color: white;
        font-family: "微软雅黑";
        font-size: 16px;
        font-weight: 800;
        overflow: hidden;
        background-color: #3498DB;
        border: none 0;
        margin-top: 3px;
        margin-left: 10px;
    }


    .text {
        width: 208px;
        height: 16px;
        padding: 5px 25px 5px 5px;
        border: 1px solid #cccccc;
        float: none;
        font-size: 14px;
        font-family: arial, "宋体";
        color: #999;
    }

    .btn-regist {
        width: 270px;
        height: 36px;
        color: #FFF;
        font-family: "微软雅黑";
        font-size: 16px;
        text-indent: -9999px;
        font-weight: 800;
        overflow: hidden;
        background: url(../images/regist-btn.jpg) no-repeat;
        border: none 0;
    }

        .btn-regist:hover {
            background: url(../images/hover-btn.jpg) no-repeat;
        }

    #table_margain {
        border: 0px solid #808080;
        border-collapse: collapse;
        margin-bottom: 1em;
    }

        #table_margain tr {
            height: 3em;
        }

            #table_margain tr td:nth-child(1) {
                width: 100px;
                text-align: right;
            }

            #table_margain tr td:nth-child(2) {
                width: 280px;
                text-align: left;
            }

    .ulproduct li {
        float: left;
        width: 200px;
        margin-left: 3px;
        line-height: 3em;
    }

    .ultalk {
        margin-left: 0.4em;
    }

        .ultalk li {
            float: left;
            width: 200px;
            line-height: 3em;
            margin-left: 1em;
        }

    .tabledesc {
        border: 0px solid #808080;
        border-collapse: collapse;
    }

        .tabledesc tr {
            height: 1.8em;
        }

            .tabledesc tr td {
                text-align: center;
            }

    .selectbox {
        width: 172px;
        height: 28px;
        padding: 5px 25px 5px 5px;
        border: 1px solid #cccccc;
        float: none;
        font-size: 13px;
        font-family: arial, "宋体";
        color: #999;
    }

    .feiyong {
        display: none;
    }
</style>

<style>
    #tabledesc td, th {
        border: 1px solid #ccc;
    }

    #tabledesc {
        margin: 0 auto;
    }

    .stop_3 {
        width: 100%;
        text-align: start;
        margin-top: 10px;
        font-size: 18px;
        font-weight: 600;
        border-bottom: 1px solid #ccc;
        line-height: 30px;
        text-indent: 2em;
        background: url(/Areas/Web/Images/step03.png) no-repeat;
        background-position: 1% 50%;
    }

    .stop_4 {
        width: 100%;
        text-align: start;
        margin-top: 10px;
        font-size: 18px;
        font-weight: 600;
        border-bottom: 1px solid #ccc;
        line-height: 30px;
        text-indent: 2em;
        background: url(/Areas/Web/Images/step04.png) no-repeat;
        background-position: 1% 50%;
    }

    .stop_2 {
        width: 100%;
        text-align: start;
        margin-top: 10px;
        font-size: 26px;
        font-weight: 900;
        border-bottom: 1px solid #ccc;
        line-height: 30px;
        text-indent: 2em;
        background: url(../img/second.png) no-repeat;
        background-position: 6% 50%;
    }
    .cart h2 {
    height: 20px;
    margin-bottom: 15px;
    line-height: 20px;
    overflow: none;
    background: #fff;
}
</style>

<div class="w990 cart">
    <input type="hidden" id="shipmentObj" />

    <input type="hidden" id="curCostObj" />

    <div style="font-size: 20px;color: #3498DB;font-weight: bolder;border-bottom: 1px solid #ccc;height: 34px;width: 98.9%;">
        <h3 class="xiadan_a" style="border-bottom: 2px solid #3498db;padding: 5px 10px;">订单确认</h3>

        <h3 class="feiyong_a" id="tabFedCost" style="width: 120px;cursor:pointer; text-align: center; color: #fff; line-height: 40px; font-size: 16px; background: #8cabbf; display:none ; padding: 0 20px; border-radius: 10px 10px 0px 0px; ">
            费用计算
        </h3>

    </div>
    <div id="show">
        <div class="box1 lh24">
            @{
                List<ChemCloud.Model.ShoppingCartItem> cartshoplist = (List<ChemCloud.Model.ShoppingCartItem>)ViewBag.cartshoplist;
                List<ChemCloud.Model.ShoppingCartItem> cartproductlist = (List<ChemCloud.Model.ShoppingCartItem>)ViewBag.cartproductlist;
                if (cartshoplist.Count > 0)
                {
                    foreach (ChemCloud.Model.ShoppingCartItem cartshopitem in cartshoplist)
                    {
                        <div class="border-box" style="margin-top:0.1em;padding-bottom:0.2em">
                            <h3 style="color: #3498DB;line-height: 30px; font-size:14px;margin-left:15px;">
                                供应商：<span>@cartshopitem.shopName</span>
                            </h3>
                            <table class="tabledesc" id="tabledesc">

                                <tr>
                                    <th style="width:12em;">产品编码</th>
                                    <th style="width:12em;">产品名称</th>
                                    <th style="width:6em;">包装规格</th>
                                    <th style="width:6em;">等级</th>
                                    <th style="width:6em;">纯度</th>
                                    <th style="width:6em;">数量</th>
                                    <th style="width:16em;">价格小计</th>
                                </tr>
                                @foreach (ChemCloud.Model.ShoppingCartItem cartproductitem in cartproductlist)
                                {
                                    if (cartproductitem != null)
                                    {
                                        if (cartproductitem.ShopId == cartshopitem.ShopId)
                                        {
                                            <tr class="productlisttr">
                                                <td>@cartproductitem.ProductId</td>
                                                <td>@cartproductitem.name</td>
                                                <td>@cartproductitem.PackingUnit</td>
                                                <td>@cartproductitem.SpecLevel</td>
                                                <td>@cartproductitem.Purity</td>
                                                <td>@cartproductitem.Quantity</td>
                                                <td><span class="price">@cartproductitem.ProductTotalAmount</span>&nbsp;@cartproductitem.CoinType</td>
                                            </tr>
                                        }
                                    }
                                }
                            </table>
                            @*<h3 style="color: #3498DB;line-height: 30px; font-size:14px;margin-left:15px;">
                                    <p>物流运费</p>
                                </h3>*@
                            <table class="tabledesc" style="width:100%;">
                                <tr>
                                    <th style="">物流配送方式</th>
                                    <th style="">物流配送费用</th>
                                    <th style="">操作</th>
                                    <th style="width:6em;display:none"></th>
                                    <th style="width:6em;display:none"></th>
                                </tr>
                                <tr class="shipDetailList">
                                    @*<td style="display:inline-block;width:86px;line-height:40px;">物流配送方式：</td>*@
                                    <td>
                                        <select class="selectbox selfreightType" name="selfreightType">
                                            <option value="EMS">EMS</option>
                                            <option value="UPS">UPS</option>
                                            <option value="FedEx" selected>FedEx</option>
                                            <option value="DHL">DHL</option>
                                            <option value="TNT">TNT</option>
                                            <option value="SF">SF</option>
                                        </select>
                                    </td>
                                    @*<td>物流配送费用：</td>*@
                                    <td>
                                        <input type="text" class="text" value="@cartshopitem.ShipmentCost" />
                                    </td>
                                    <td>
                                        <span class="yuenFei" style="width:82px;height: 25px;font-size: 12px;cursor:pointer;background: rgb(52, 152, 219);line-height: 25px;color: #fff;">费用明细</span>
                                    </td>
                                    <td style="display:none">
                                        @cartshopitem.ShipmentValue
                                    </td>
                                    <td style="display:none">
                                        @cartshopitem.ShopId
                                    </td>
                                </tr>

                            </table>
                        </div>
                    }
                }
            }
            <style type="text/css">
                .xiadan {
                    width: 1000px;
                    margin: 0 auto;
                    margin-top: -20px;
                }

                .xiadan_a {
                    width: 120px;
                    cursor: pointer;
                    text-align: center;
                    color: #fff;
                    line-height: 25px;
                    font-size: 16px;
                    background: #8cabbf;
                    display: inline-block;
                    padding: 0 20px;
                    border-radius: 10px 10px 0px 0px;
                }

                .border-box {
                    margin-top: -0.9em;
                    padding-bottom: 0.2em;
                    border: 2px solid #dae1e6;
                    min-height: 19em;
                    width: 98.6%;
                }

                .ulproduct {
                    background: #dae1e6;
                }

                    .ulproduct li {
                        float: left;
                        width: 200px;
                        margin-left: 3px;
                        line-height: 3em;
                    }

                .stop_1 {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 26px;
                    font-weight: 900;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 2em;
                    background: url(../img/step01.png) no-repeat;
                    background-position: 1% 50%;
                }

                .btn-margain {
                    width: 156px;
                    height: 36px;
                    color: white;
                    font-family: "微软雅黑";
                    font-size: 16px;
                    font-weight: 800;
                    overflow: hidden;
                    background-color: #3498DB;
                    border: none 0;
                    margin-top: 20px;
                    float: right;
                    margin-right: 14px;
                }

                .text {
                    width: 140px;
                    margin-left: 4px;
                    height: 16px;
                    padding: 5px 25px 5px 5px;
                    border: 1px solid #cccccc;
                    float: none;
                    font-size: 14px;
                    font-family: arial, "宋体";
                    color: #999;
                }

                .tabledesc {
                    border: 0px solid #808080;
                    border-collapse: collapse;
                    margin-top: 3em;
                    margin-top: 1em;
                }

                    .tabledesc tr {
                        height: 1.3em;
                    }

                        .tabledesc tr td {
                            width: 5em;
                            text-align: center;
                        }

                .ulproduct li {
                    width: 100%;
                    margin-top: -18px;
                    list-style: none;
                }

                .tabledesc tr {
                    height: 3.3em;
                }

                .tabledesc tr th {
                    background: #3498DB;
                    color: #fff;
                    font-size: 16px;
                    height: 40px;
                }
                .tabledesc tr td{
                    border:1px solid rgb(204,204,204);
                }
                .tabledesc #border_lja {
                    border-bottom: 1px dotted #dae1e6;
                }

                    .tabledesc #border_lja:last-child {
                        border-bottom: none;
                    }

                .steptwo {
                    float: left;
                    width: 32%;
                    margin: 0 9px 0 0;
                    border: 2px solid #dae1e6;
                    min-height: 24em;
                }

                .stop_2 {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 26px;
                    font-weight: 900;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 2em;
                    background: url(../img/step02.png) no-repeat;
                    background-position: 6% 50%;
                }

                .table_margain {
                    margin: 0 auto;
                    border: 0px solid #808080;
                    border-collapse: collapse;
                    margin-bottom: 1em;
                }

                    .table_margain tr {
                        height: 3em;
                    }

                        .table_margain tr td:first-child {
                            height: 3em;
                            text-align: right;
                        }

                .selectbox {
                    width: 172px;
                    height: 28px;
                    margin-left: 4px;
                    padding: 5px 25px 5px 5px;
                    border: 1px solid #cccccc;
                }
            </style>

            <div class="steptwo" id="border-box_1" style="margin-top: 1em; border: 2px solid #dae1e6;">
                <p class="stop_1">物流运费</p>
                <table class="table_margain">
                    <tr style="display:none">
                        <td style="display:inline-block;width:86px;line-height:40px;">物流配送方式：</td>
                        <td>
                            <select class="selectbox" id="freighttype">
                                <option value="EMS">EMS</option>
                                <option value="UPS">UPS</option>
                                <option value="FedEx" selected>FedEx</option>
                                <option value="UPS">DHL</option>
                                <option value="TNT">TNT</option>
                                <option value="SF">SF</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>物流配送费用：</td>
                        <td>
                            <input type="text" class="text" id="txtfreight" value="0.00" />
                        </td>
                    </tr>
                </table>
                <p style="margin-top:0.1em;display:none ">
                    <input type="button" class="btn-margain yuenFei" style="cursor:pointer" id="btnShipDetail" value="运费明细">
                </p>
            </div>
            <div class="steptwo" id="border-box_2" style="margin-top: 1em; border: 2px solid #dae1e6;">
                <p class="stop_2">开票信息<input type="checkbox" id="cbinvoice" style="margin-left:20px" /></p>
                <table class="table_margain">
                    <tr>
                        <td>*&nbsp;发票类型：</td>
                        <td>
                            <select class="selectbox" id="invoicetype" disabled="disabled">
                                <option value="1">平台发票</option>
                                <option value="2">普通发票</option>
                                <option value="3">专票</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>*&nbsp;名称：</td>
                        <td>
                            <input type="text" class="text" id="txtinvoicename" disabled="disabled" />
                        </td>
                    </tr>
                    <tr class="invoicetr">
                        <td>纳税人识别号：</td>
                        <td>
                            <input type="text" class="text invoicetr" id="txttaxpayeridentificationnumber" />
                        </td>
                    </tr>
                    <tr class="invoicetr">
                        <td>电话：</td>
                        <td>
                            <input type="text" class="text invoicetr" id="txtcallnumber" />
                        </td>
                    </tr>
                    <tr class="invoicetr">
                        <td>开户行及账号：</td>
                        <td>
                            <input type="text" class="text invoicetr" id="txtbankaccount" />
                        </td>
                    </tr>
                    <tr class="invoicetr">
                        <td>账单地址：</td>
                        <td>

                            <select id="incoiceaddress" class="selectbox"  style="width:200px;">
                                @foreach (var m in Model)
                                {
                                    <option value="@m.Id">@m.RegionFullName>@m.Address</option>
                                }
                            </select>


                            @*<a style="width:82px;height: 25px;font-size: 12px;"
                                href="/UserAddress/Index?fromorder=1"
                                id="btneditdeliveryaddress">编辑</a>*@

                        </td>
                    </tr>
                </table>

            </div>
            <div class="steptwo" id="border-box_3" style="margin-top: 1em; border: 2px solid #dae1e6;">
                <p class="stop_3">收货信息</p>
                <table class="table_margain">
                    <tr>
                        <td>收货地址：</td>
                        <td>
                            <select id="deliveryaddress" class="selectbox" style="width:200px;">
                                @foreach (var m in Model)
                                {
                                    <option value="@m.Id">@m.RegionFullName>@m.Address</option>
                                }
                            </select>


                            @*<a style="width:82px;height: 25px;font-size: 12px;"
                                href="/UserAddress/Index?fromorder=1"
                                id="btneditdeliveryaddress">编辑</a>*@

                        </td>
                    </tr>
                </table>
                <p style="float:right;float:right;margin-right:40px;">
                    <input type="checkbox" id="cbinsurance" /> <span>保险金额:</span><span class="insurancefee">0.00</span> <span>CNY</span>
                </p>
            </div>
            <div style="clear:both;"></div>
            <div id="fot">
                <p style="margin-top:0.1em; ">
                    <input type="button" class="btn-margain" id="submitmargain" style="cursor:pointer;" value="提交订单">
                    <span style="font-weight: bolder; color:red;margin-top: 30px;float: right;margin-right: 26px;">订单总结额：<span class="orderamount" style="float:right;">0.00</span> </span>
                </p>
                <div style="height:20px;width:100%;clear:both;"></div>
            </div>
        </div>
    </div>

    <div class="feiyong" style="background:#fff">
        <div>
            <style>
                .baseTitle {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 18px;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 1em;
                }

                .stop_1 {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 18px;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 2em;
                    background: url(/Areas/Web/Images/step01.png) no-repeat;
                    background-position: 1% 50%;
                }

                .stop_2 {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 18px;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 2em;
                    background: url(/Areas/Web/Images/step02.png) no-repeat;
                    background-position: 1% 50%;
                }

                .stop_3 {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 18px;
                    font-weight: 600;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 2em;
                    background: url(/Areas/Web/Images/step03.png) no-repeat;
                    background-position: 1% 50%;
                }

                .stop_4 {
                    width: 100%;
                    text-align: start;
                    margin-top: 10px;
                    font-size: 18px;
                    font-weight: 600;
                    border-bottom: 1px solid #ccc;
                    line-height: 30px;
                    text-indent: 2em;
                    background: url(/Areas/Web/Images/step04.png) no-repeat;
                    background-position: 1% 50%;
                }

                .textcolspan {
                    width: 556px;
                    height: 16px;
                    padding: 5px 25px 5px 5px;
                    border: 1px solid #cccccc;
                    float: none;
                    font-size: 14px;
                    font-family: arial, "宋体";
                    color: #999;
                }

                .selectbox {
                    width: 172px;
                    height: 28px;
                    padding: 5px 25px 5px 5px;
                    border: 1px solid #cccccc;
                    float: none;
                    font-size: 13px;
                    font-family: arial, "宋体";
                    color: #999;
                }

                .selectbox1 {
                    width: 100px;
                    height: 28px;
                    padding: 5px 25px 5px 5px;
                    border: 1px solid #cccccc;
                    float: none;
                    font-size: 13px;
                    font-family: arial, "宋体";
                    color: #999;
                }

                .table_margain {
                    border: 0px solid #808080;
                    border-collapse: collapse;
                    margin-bottom: 1em;
                }

                    .table_margain tr {
                        height: 3em;
                    }

                /*.table_margain tr td:nth-child(1) {
                        width: 100px;
                        text-align: right;
                    }

                     .table_margain tr td:nth-child(2) {
                        width: 280px;
                        text-align: left;
                    }*/

                .tdLabel {
                    width: 100px;
                    text-align: right;
                }

                .tdControl {
                    width: 280px;
                    text-align: left;
                }

                sup {
                    color: rgb(240,72,60);
                }

                .si_mu {
                    background: url(/Areas/Web/Images/first.png) no-repeat;
                    background-position: 1% 50%;
                    text-indent: 2em;
                }

                .si_mu_2 {
                    text-indent: 2em;
                    background: url(/Areas/Web/Images/second.png) no-repeat;
                    background-position: 1% 50%;
                }

                .si_mu_3 {
                    text-indent: 2em;
                    background: url(/Areas/Web/Images/lja_sb.png) no-repeat;
                    background-position: 1% 50%;
                }
            </style>

            @*<div class="border-box" style="margin-top: 1em; border: 2px solid #dae1e6;">
                    <p class="baseTitle">
                        基本信息
                    </p>
                     <table id="table_base"></table>
                </div>*@
            <div class="border-box" style="    margin-top: 0px; border: 2px solid #dae1e6;">
                <p class="baseTitle si_mu">
                    托运始发地/目的地
                </p>
                <table id="table_orgin" class="table_margain">
                    <tr>
                        <td colspan="6" style="width:100%"><h2 style="padding-bottom: 3px;text-align:left; border-bottom:1px solid rgb(12,110,180); margin: 10px 0 5px 0;color: rgb(12,110,180);">&nbsp;&nbsp;始发地</h2></td>
                    </tr>
                    <tr>
                        <td class="tdLabel"><sup style="">*</sup>国家/地点：</td>
                        <td>
                            <select name="origCountry" id="origCountry" disabled="disabled" class="selectbox">
                                <option value="US" selected="selected">United States</option>
                                <option value="AF">Afghanistan</option>
                                <option value="AL">Albania</option>
                                <option value="DZ">Algeria</option>
                                <option value="AS">American Samoa</option>
                                <option value="AD">Andorra</option>
                                <option value="AO">Angola</option>
                                <option value="AI">Anguilla</option>
                                <option value="AG">Antigua/Barbuda</option>
                                <option value="AR">Argentina</option>
                                <option value="AM">Armenia</option>
                                <option value="AW">Aruba</option>
                                <option value="AU">Australia</option>
                                <option value="AT">Austria</option>
                                <option value="AZ">Azerbaijan</option>
                                <option value="BS">Bahamas</option>
                                <option value="BH">Bahrain</option>
                                <option value="BD">Bangladesh</option>
                                <option value="BB">Barbados</option>
                                <option value="BY">Belarus</option>
                                <option value="BE">Belgium</option>
                                <option value="BZ">Belize</option>
                                <option value="BJ">Benin</option>
                                <option value="BM">Bermuda</option>
                                <option value="BT">Bhutan</option>
                                <option value="BO">Bolivia</option>
                                <option value="BA">Bosnia-Herzegovina</option>
                                <option value="BW">Botswana</option>
                                <option value="BR">Brazil</option>
                                <option value="VG">British Virgin Islands</option>
                                <option value="BN">Brunei</option>
                                <option value="BG">Bulgaria</option>
                                <option value="BF">Burkina Faso</option>
                                <option value="BI">Burundi</option>
                                <option value="KH">Cambodia</option>
                                <option value="CM">Cameroon</option>
                                <option value="CA">Canada</option>
                                <option value="CV">Cape Verde</option>
                                <option value="BQ">Caribbean Netherlands</option>
                                <option value="KY">Cayman Islands</option>
                                <option value="TD">Chad</option>
                                <option value="CL">Chile</option>
                                <option value="CN">China</option>
                                <option value="CO">Colombia</option>
                                <option value="CG">Congo Brazzaville</option>
                                <option value="CD">Congo Democratic Rep. of</option>
                                <option value="CK">Cook Islands</option>
                                <option value="CR">Costa Rica</option>
                                <option value="HR">Croatia</option>
                                <option value="CW">Curacao</option>
                                <option value="CY">Cyprus</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="DK">Denmark</option>
                                <option value="DJ">Djibouti</option>
                                <option value="DM">Dominica</option>
                                <option value="DO">Dominican Republic</option>
                                <option value="TL">East Timor</option>
                                <option value="EC">Ecuador</option>
                                <option value="EG">Egypt</option>
                                <option value="SV">El Salvador</option>
                                <option value="GQ">Equatorial Guinea</option>
                                <option value="ER">Eritrea</option>
                                <option value="EE">Estonia</option>
                                <option value="ET">Ethiopia</option>
                                <option value="FO">Faeroe Islands</option>
                                <option value="FJ">Fiji</option>
                                <option value="FI">Finland</option>
                                <option value="FR">France</option>
                                <option value="GF">French Guiana</option>
                                <option value="PF">French Polynesia</option>
                                <option value="GA">Gabon</option>
                                <option value="GM">Gambia</option>
                                <option value="GE">Georgia</option>
                                <option value="DE">Germany</option>
                                <option value="GH">Ghana</option>
                                <option value="GI">Gibraltar</option>
                                <option value="GR">Greece</option>
                                <option value="GL">Greenland</option>
                                <option value="GD">Grenada</option>
                                <option value="GP">Guadeloupe</option>
                                <option value="GU">Guam</option>
                                <option value="GT">Guatemala</option>
                                <option value="GN">Guinea</option>
                                <option value="GY">Guyana</option>
                                <option value="HT">Haiti</option>
                                <option value="HN">Honduras</option>
                                <option value="HK">Hong Kong</option>
                                <option value="HU">Hungary</option>
                                <option value="IS">Iceland</option>
                                <option value="IN">India</option>
                                <option value="ID">Indonesia</option>
                                <option value="IQ">Iraq</option>
                                <option value="IE">Ireland</option>
                                <option value="IL">Israel</option>
                                <option value="IT">Italy</option>
                                <option value="CI">Ivory Coast</option>
                                <option value="JM">Jamaica</option>
                                <option value="JP">Japan</option>
                                <option value="JO">Jordan</option>
                                <option value="KZ">Kazakhstan</option>
                                <option value="KE">Kenya</option>
                                <option value="KW">Kuwait</option>
                                <option value="KG">Kyrgyzstan</option>
                                <option value="LA">Laos</option>
                                <option value="LV">Latvia</option>
                                <option value="LB">Lebanon</option>
                                <option value="LS">Lesotho</option>
                                <option value="LR">Liberia</option>
                                <option value="LY">Libya</option>
                                <option value="LI">Liechtenstein</option>
                                <option value="LT">Lithuania</option>
                                <option value="LU">Luxembourg</option>
                                <option value="MO">Macau</option>
                                <option value="MK">Macedonia</option>
                                <option value="MG">Madagascar</option>
                                <option value="MW">Malawi</option>
                                <option value="MY">Malaysia</option>
                                <option value="MV">Maldives</option>
                                <option value="ML">Mali</option>
                                <option value="MT">Malta</option>
                                <option value="MH">Marshall Islands</option>
                                <option value="MQ">Martinique</option>
                                <option value="MR">Mauritania</option>
                                <option value="MU">Mauritius</option>
                                <option value="MX">Mexico</option>
                                <option value="FM">Micronesia</option>
                                <option value="MD">Moldova</option>
                                <option value="MC">Monaco</option>
                                <option value="MN">Mongolia</option>
                                <option value="ME">Montenegro</option>
                                <option value="MS">Montserrat</option>
                                <option value="MA">Morocco</option>
                                <option value="MZ">Mozambique</option>
                                <option value="NA">Namibia</option>
                                <option value="NP">Nepal</option>
                                <option value="NL">Netherlands</option>
                                <option value="NC">New Caledonia</option>
                                <option value="NZ">New Zealand</option>
                                <option value="NI">Nicaragua</option>
                                <option value="NE">Niger</option>
                                <option value="NG">Nigeria</option>
                                <option value="NO">Norway</option>
                                <option value="OM">Oman</option>
                                <option value="PK">Pakistan</option>
                                <option value="PW">Palau</option>
                                <option value="PS">Palestine Autonomous</option>
                                <option value="PA">Panama</option>
                                <option value="PG">Papua New Guinea</option>
                                <option value="PY">Paraguay</option>
                                <option value="PE">Peru</option>
                                <option value="PH">Philippines</option>
                                <option value="PL">Poland</option>
                                <option value="PT">Portugal</option>
                                <option value="PR">Puerto Rico</option>
                                <option value="QA">Qatar</option>
                                <option value="RE">Reunion</option>
                                <option value="RO">Romania</option>
                                <option value="RU">Russian Federation</option>
                                <option value="RW">Rwanda</option>
                                <option value="MF">Saint Martin</option>
                                <option value="MP">Saipan</option>
                                <option value="WS">Samoa</option>
                                <option value="SA">Saudi Arabia</option>
                                <option value="SN">Senegal</option>
                                <option value="RS">Serbia</option>
                                <option value="SC">Seychelles</option>
                                <option value="SG">Singapore</option>
                                <option value="SX">Sint Maarten</option>
                                <option value="SK">Slovak Republic</option>
                                <option value="SI">Slovenia</option>
                                <option value="ZA">South Africa</option>
                                <option value="KR">South Korea</option>
                                <option value="ES">Spain</option>
                                <option value="LK">Sri Lanka</option>
                                <option value="KN">St. Kitts/Nevis</option>
                                <option value="LC">St. Lucia</option>
                                <option value="VC">St. Vincent</option>
                                <option value="SR">Suriname</option>
                                <option value="SZ">Swaziland</option>
                                <option value="SE">Sweden</option>
                                <option value="CH">Switzerland</option>
                                <option value="SY">Syria</option>
                                <option value="TW">Taiwan</option>
                                <option value="TZ">Tanzania</option>
                                <option value="TH">Thailand</option>
                                <option value="TG">Togo</option>
                                <option value="TO">Tonga</option>
                                <option value="TT">Trinidad/Tobago</option>
                                <option value="TN">Tunisia</option>
                                <option value="TR">Turkey</option>
                                <option value="TM">Turkmenistan</option>
                                <option value="TC">Turks &amp; Caicos Islands</option>
                                <option value="VI">U.S. Virgin Islands</option>
                                <option value="UG">Uganda</option>
                                <option value="UA">Ukraine</option>
                                <option value="AE">United Arab Emirates</option>
                                <option value="GB">United Kingdom</option>
                                <option value="UY">Uruguay</option>
                                <option value="UZ">Uzbekistan</option>
                                <option value="VU">Vanuatu</option>
                                <option value="VE">Venezuela</option>
                                <option value="VN">Vietnam</option>
                                <option value="WF">Wallis &amp; Futuna</option>
                                <option value="YE">Yemen</option>
                                <option value="ZM">Zambia</option>
                                <option value="ZW">Zimbabwe</option>
                            </select>
                        </td>
                        <td class="tdLabel"><sup style="">*</sup>城市：</td>
                        <td><input type="text" id="origCity" class="text" disabled="disabled" /></td>
                        <td class="tdLabel"><sup style="">*</sup>邮编：</td>
                        <td>
                            <input type="text" id="origPostCode" class="text youbian" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tdLabel"><div class="dizhi">地址：</div></td>
                        <td colspan="3"><input type="text" style="margin-left:4px;" id="origAddress" class="textcolspan" disabled="disabled" /></td>
                    </tr>

                    <tr>
                        <td colspan="6"><h2 style="padding-bottom: 3px; text-align:left;border-bottom: 1px solid rgb(12,110,180); margin: 10px 0 5px 0;color:rgb(12,110,180)">&nbsp;&nbsp;目的地</h2></td>
                    </tr>
                    <tr>
                        <td class="tdLabel"><sup style="">*</sup>国家/地点：</td>
                        <td>
                            <select name="destCountry" id="destCountry" class="selectbox" disabled="disabled">
                                <option value="US" selected="selected">United States</option>
                                <option value="AF">Afghanistan</option>
                                <option value="AL">Albania</option>
                                <option value="DZ">Algeria</option>
                                <option value="AS">American Samoa</option>
                                <option value="AD">Andorra</option>
                                <option value="AO">Angola</option>
                                <option value="AI">Anguilla</option>
                                <option value="AG">Antigua/Barbuda</option>
                                <option value="AR">Argentina</option>
                                <option value="AM">Armenia</option>
                                <option value="AW">Aruba</option>
                                <option value="AU">Australia</option>
                                <option value="AT">Austria</option>
                                <option value="AZ">Azerbaijan</option>
                                <option value="BS">Bahamas</option>
                                <option value="BH">Bahrain</option>
                                <option value="BD">Bangladesh</option>
                                <option value="BB">Barbados</option>
                                <option value="BY">Belarus</option>
                                <option value="BE">Belgium</option>
                                <option value="BZ">Belize</option>
                                <option value="BJ">Benin</option>
                                <option value="BM">Bermuda</option>
                                <option value="BT">Bhutan</option>
                                <option value="BO">Bolivia</option>
                                <option value="BA">Bosnia-Herzegovina</option>
                                <option value="BW">Botswana</option>
                                <option value="BR">Brazil</option>
                                <option value="VG">British Virgin Islands</option>
                                <option value="BN">Brunei</option>
                                <option value="BG">Bulgaria</option>
                                <option value="BF">Burkina Faso</option>
                                <option value="BI">Burundi</option>
                                <option value="KH">Cambodia</option>
                                <option value="CM">Cameroon</option>
                                <option value="CA">Canada</option>
                                <option value="CV">Cape Verde</option>
                                <option value="BQ">Caribbean Netherlands</option>
                                <option value="KY">Cayman Islands</option>
                                <option value="TD">Chad</option>
                                <option value="CL">Chile</option>
                                <option value="CN">China</option>
                                <option value="CO">Colombia</option>
                                <option value="CG">Congo Brazzaville</option>
                                <option value="CD">Congo Democratic Rep. of</option>
                                <option value="CK">Cook Islands</option>
                                <option value="CR">Costa Rica</option>
                                <option value="HR">Croatia</option>
                                <option value="CW">Curacao</option>
                                <option value="CY">Cyprus</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="DK">Denmark</option>
                                <option value="DJ">Djibouti</option>
                                <option value="DM">Dominica</option>
                                <option value="DO">Dominican Republic</option>
                                <option value="TL">East Timor</option>
                                <option value="EC">Ecuador</option>
                                <option value="EG">Egypt</option>
                                <option value="SV">El Salvador</option>
                                <option value="GQ">Equatorial Guinea</option>
                                <option value="ER">Eritrea</option>
                                <option value="EE">Estonia</option>
                                <option value="ET">Ethiopia</option>
                                <option value="FO">Faeroe Islands</option>
                                <option value="FJ">Fiji</option>
                                <option value="FI">Finland</option>
                                <option value="FR">France</option>
                                <option value="GF">French Guiana</option>
                                <option value="PF">French Polynesia</option>
                                <option value="GA">Gabon</option>
                                <option value="GM">Gambia</option>
                                <option value="GE">Georgia</option>
                                <option value="DE">Germany</option>
                                <option value="GH">Ghana</option>
                                <option value="GI">Gibraltar</option>
                                <option value="GR">Greece</option>
                                <option value="GL">Greenland</option>
                                <option value="GD">Grenada</option>un
                                <option value="GP">Guadeloupe</option>
                                <option value="GU">Guam</option>
                                <option value="GT">Guatemala</option>
                                <option value="GN">Guinea</option>
                                <option value="GY">Guyana</option>
                                <option value="HT">Haiti</option>
                                <option value="HN">Honduras</option>
                                <option value="HK">Hong Kong</option>
                                <option value="HU">Hungary</option>
                                <option value="IS">Iceland</option>
                                <option value="IN">India</option>
                                <option value="ID">Indonesia</option>
                                <option value="IQ">Iraq</option>
                                <option value="IE">Ireland</option>
                                <option value="IL">Israel</option>
                                <option value="IT">Italy</option>
                                <option value="CI">Ivory Coast</option>
                                <option value="JM">Jamaica</option>
                                <option value="JP">Japan</option>
                                <option value="JO">Jordan</option>
                                <option value="KZ">Kazakhstan</option>
                                <option value="KE">Kenya</option>
                                <option value="KW">Kuwait</option>
                                <option value="KG">Kyrgyzstan</option>
                                <option value="LA">Laos</option>
                                <option value="LV">Latvia</option>
                                <option value="LB">Lebanon</option>
                                <option value="LS">Lesotho</option>
                                <option value="LR">Liberia</option>
                                <option value="LY">Libya</option>
                                <option value="LI">Liechtenstein</option>
                                <option value="LT">Lithuania</option>
                                <option value="LU">Luxembourg</option>
                                <option value="MO">Macau</option>
                                <option value="MK">Macedonia</option>
                                <option value="MG">Madagascar</option>
                                <option value="MW">Malawi</option>
                                <option value="MY">Malaysia</option>
                                <option value="MV">Maldives</option>
                                <option value="ML">Mali</option>
                                <option value="MT">Malta</option>
                                <option value="MH">Marshall Islands</option>
                                <option value="MQ">Martinique</option>
                                <option value="MR">Mauritania</option>
                                <option value="MU">Mauritius</option>
                                <option value="MX">Mexico</option>
                                <option value="FM">Micronesia</option>
                                <option value="MD">Moldova</option>
                                <option value="MC">Monaco</option>
                                <option value="MN">Mongolia</option>
                                <option value="ME">Montenegro</option>
                                <option value="MS">Montserrat</option>
                                <option value="MA">Morocco</option>
                                <option value="MZ">Mozambique</option>
                                <option value="NA">Namibia</option>
                                <option value="NP">Nepal</option>
                                <option value="NL">Netherlands</option>
                                <option value="NC">New Caledonia</option>
                                <option value="NZ">New Zealand</option>
                                <option value="NI">Nicaragua</option>
                                <option value="NE">Niger</option>
                                <option value="NG">Nigeria</option>
                                <option value="NO">Norway</option>
                                <option value="OM">Oman</option>
                                <option value="PK">Pakistan</option>
                                <option value="PW">Palau</option>
                                <option value="PS">Palestine Autonomous</option>
                                <option value="PA">Panama</option>
                                <option value="PG">Papua New Guinea</option>
                                <option value="PY">Paraguay</option>
                                <option value="PE">Peru</option>
                                <option value="PH">Philippines</option>
                                <option value="PL">Poland</option>
                                <option value="PT">Portugal</option>
                                <option value="PR">Puerto Rico</option>
                                <option value="QA">Qatar</option>
                                <option value="RE">Reunion</option>
                                <option value="RO">Romania</option>
                                <option value="RU">Russian Federation</option>
                                <option value="RW">Rwanda</option>
                                <option value="MF">Saint Martin</option>
                                <option value="MP">Saipan</option>
                                <option value="WS">Samoa</option>
                                <option value="SA">Saudi Arabia</option>
                                <option value="SN">Senegal</option>
                                <option value="RS">Serbia</option>
                                <option value="SC">Seychelles</option>
                                <option value="SG">Singapore</option>
                                <option value="SX">Sint Maarten</option>
                                <option value="SK">Slovak Republic</option>
                                <option value="SI">Slovenia</option>
                                <option value="ZA">South Africa</option>
                                <option value="KR">South Korea</option>
                                <option value="ES">Spain</option>
                                <option value="LK">Sri Lanka</option>
                                <option value="KN">St. Kitts/Nevis</option>
                                <option value="LC">St. Lucia</option>
                                <option value="VC">St. Vincent</option>
                                <option value="SR">Suriname</option>
                                <option value="SZ">Swaziland</option>
                                <option value="SE">Sweden</option>
                                <option value="CH">Switzerland</option>
                                <option value="SY">Syria</option>
                                <option value="TW">Taiwan</option>
                                <option value="TZ">Tanzania</option>
                                <option value="TH">Thailand</option>
                                <option value="TG">Togo</option>
                                <option value="TO">Tonga</option>
                                <option value="TT">Trinidad/Tobago</option>
                                <option value="TN">Tunisia</option>
                                <option value="TR">Turkey</option>
                                <option value="TM">Turkmenistan</option>
                                <option value="TC">Turks &amp; Caicos Islands</option>
                                <option value="VI">U.S. Virgin Islands</option>
                                <option value="UG">Uganda</option>
                                <option value="UA">Ukraine</option>
                                <option value="AE">United Arab Emirates</option>
                                <option value="GB">United Kingdom</option>

                                <option value="UY">Uruguay</option>
                                <option value="UZ">Uzbekistan</option>
                                <option value="VU">Vanuatu</option>
                                <option value="VE">Venezuela</option>
                                <option value="VN">Vietnam</option>
                                <option value="WF">Wallis &amp; Futuna</option>
                                <option value="YE">Yemen</option>
                                <option value="ZM">Zambia</option>
                                <option value="ZW">Zimbabwe</option>
                            </select>
                        </td>
                        <td class="tdLabel"><sup style="">*</sup>城市：</td>
                        <td><input type="text" id="destCity" class="text" disabled="disabled" /></td>
                        <td class="tdLabel"><sup style="">*</sup>邮编：</td>
                        <td>
                            <input type="text" id="destPostCode" class="text youbian" disabled="disabled" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tdLabel"><div class="dizhi">地址：</div></td>
                        <td colspan="3"><input type="text" id="destAddress" style="margin-left:4px;" class="textcolspan" disabled="disabled" /></td>
                    </tr>
                    <tr>
                        <td colspan="6"><h2 style="padding-bottom: 3px;text-align:left; border-bottom: 1px solid rgb(11,110,180); margin: 10px 0 5px 0;color:rgb(11,110,180)">&nbsp;&nbsp;附加信息</h2></td>
                    </tr>
                    <tr>
                        <td class="tdLabel"><sup>*</sup>包裹数量：</td>
                        <td><input type="text" id="packageNum" class="text" disabled="disabled" /></td>


                    </tr>
                    <tr>
                        <td class="tdLabel"><sup>*</sup>重量：</td>
                        <td colspan="5">
                            <input type="text" id="packageWeight" class="text" disabled="disabled" />
                            <select name="weightUnit" id="weightUnit" class="selectbox1" disabled="disabled">
                                <option value="LB">磅</option>
                                <option value="KG">公斤</option>
                            </select>
                        </td>
                    </tr>

                </table>
            </div>
            <div class="border-box" style="margin-top: 1em; border: 2px solid #dae1e6;">
                <p class="baseTitle si_mu_2">
                    包裹和货件详细信息
                </p>
                <table class="tabledesc" id="tablepackgedesc" style="margin-top:1em;" border="0" cellpadding="3" cellspacing="1" width="100%" align="center">
                    <thead>
                        <tr>
                            <th>*数量</th>
                            <th>*重量(每件包裹)</th>
                            <th>*包裹类型</th>
                            <th>尺寸(每件包裹)</th>
                            <th>托运申报价值(每件包裹)</th>
                        </tr>
                    </thead>
                    <tbody id="tablepackage_body"></tbody>

                </table>

            </div>
            <div class="border-box" style="margin-top: 1em; border: 2px solid #dae1e6;">
                <p class="baseTitle si_mu_3">
                    费率和运送时间
                </p>
                <table class="tabledesc" id="tableratedesc" style="margin-top:1em;" border="0" cellpadding="3" cellspacing="1" width="100%" align="center">
                    <thead>
                        <tr>
                            <th>选择</th>
                            <th>送递日期/时间</th>
                            <th>服务</th>
                            <th>费率</th>
                        </tr>
                    </thead>
                    <tbody id="tableratedesc_body"></tbody>

                </table>
            </div>

            <input type="button" class="btn-margain xiadan_a" id="subFedCost" style="cursor: pointer; width: 90px; float: right; border-radius: 0; line-height: 34px;" value="完成">
        </div>
    </div>
</div>


<script type="text/javascript">
    $(function () {
        var curCostObj = null;

        $(".yuenFei").click(function () {
            var distributiontype = $(this).parent().parent().children('td').eq(0).find('select').val();

            if (distributiontype != "FedEx" && distributiontype != "SF") {
                $.dialog.tips("不存在相应物流信息!");
                return;
            }

            var shipObj = $(this).parent().parent().children('td').eq(3).html();
            if (shipObj == null || shipObj == "") {
                $.dialog.tips("不存在相应物流信息!");
                return;
            }

            curCostObj = $(this).parent().parent().children('td').eq(1).find('input');


            $('.feiyong').css("display", "block");

            //显示费用详细
            displayShipDetail(shipObj);
        });
        //输入运费时同步总运费累计值
        $(".shipDetailList td input").blur(function () {
            costTotalCalc();
        });
        //勾选开票信息时，才可选编辑票据信息
        $("#cbinvoice").change(function () {
            if ($(this).attr("checked") == "checked") {
                $("#invoicetype").removeAttr("disabled");
                $("#txtinvoicename").removeAttr("disabled");
                $("#incoiceaddress").removeAttr("disabled");
            }
            else {
                $("#invoicetype").attr("disabled", "disabled");
                $("#txtinvoicename").attr("disabled", "disabled");
                $("#incoiceaddress").attr("disabled", "disabled");
            }
        });

        $(".feiyong_a").click(function () {
            $(".xiadan").css("display", "none");
            $(".feiyong").css("display", "block");
        });

        $(".xiadan_a").click(function () {

            $(".feiyong").css("display", "none");
            $(".xiadan").css("display", "block");
        })

        //FedEx物流费
        $(".selfreightType").change(function () {
            var freightVal = $(this).children('option:selected').val();
            var shipObj = $(this).parent().parent().children('td').eq(3);
            var costInput = $(this).parent().parent().children('td').eq(1).find('input');
            var prodList = $(this).parents(".tabledesc").parent().find(".tabledesc .productlisttr");
            var prodShopId = $(this).parent().parent().children('td').eq(4).html();
            if (freightVal != null) {
                if (freightVal == "FedEx" || freightVal == "SF") {
                    costCalcAdv(freightVal, prodList, costInput, shipObj, prodShopId);
                }
                else {
                    $(this).parent().parent().children('td').eq(1).find('input').val(0);
                }

                
            }
        });


        //计算所有物流费用
        $(document).ready(function () {
            costTotalCalc();
        });

        //计算物流费用
        function costCalcAdv(distributiontype, prodList, costInput, shipObj, prodShopId)
        {
            if (distributiontype != "FedEx" && distributiontype != "SF") {
                return;
            }
            var shopid = prodShopId;
            
            var DestId = $("#deliveryaddress").find("option:selected").val();//地址ID
            var DestAddress = $("#deliveryaddress").find("option:selected").text();
            $("#shipmentObj").val("");
            var Packages = "";
            Packages += "[";
            prodList.each(function () {
                productnum = $(this).children('td').eq(5).html();
                packingunit = $(this).children('td').eq(2).html();
                if (Number(productnum) > 0) {
                    Packages += "{";
                    Packages += "\"Num\":\"" + productnum + "\",";
                    Packages += "\"PackingUnit\":\"" + packingunit + "\"";
                    Packages += "},";
                }
            });
            Packages = Packages.substring(0, Packages.length - 1);
            Packages += "]";


            var pkg = null;
            if (Packages.length > 1) {
                pkg = JSON.parse(Packages);
            }

            if (pkg == null || pkg.length <= 0) {
                costInput.attr("value", 0);
                return false;
            }
            var shipdata = {
                "OrigId": "", "OrigAddress": "", "DestId": DestId, "DestAddress": DestAddress,
                "ShopId": shopid, "ShipType": distributiontype,
                "PackagesList": pkg,
                "FedexKey": "", "FedexPassword": "", "FedexAccountNumber": "", "FedexMeterNumber": "", "CoinType": ""
            };
            shipdata = JSON.stringify(shipdata);


            var loading = showLoading();
            $.ajax({
                type: 'POST',
                url: "/Shipment/CalcPrice",
                contentType: "application/json; charset=utf-8",
                data: shipdata,
                dataType: "json",
                success: function (data) {
                    loading.close();
                    shipObj.html(JSON.stringify(data));
                    if (data != null) {
                        if (data.RateValue != null) {
                            var tmpValue = parseFloat(data.RateValue.TotalCharges);
                            costInput.attr("value", tmpValue);
                        }
                        else {
                            costInput.attr("value", 0);
                        }

                        //计算所有费用
                        costTotalCalc();
                    }

                },
                error: function (e) {
                    $.dialog.errorTips('物流配送费用计算失败');
                }
            });
        }

        //计算费用
        function costCalc(shipObj, costInput) {

            if (shipObj == null || shipObj == "") {
                $.dialog.tips("不存在相应物流信息!");
                return;
            }

            if (shipObj != "" && shipObj != null) {
                var data = JSON.parse(shipObj);
                if (data != null) {
                    if (data.RateValue != null) {
                        var tmpValue = parseFloat(data.RateValue.TotalCharges);
                        costInput.val(tmpValue);
                    }
                    else {
                        costInput.val(0);
                    }
                }
            }

        }

        //计算汇总费用
        function costTotalCalc() {
            var totalCost = 0;
            $(".shipDetailList").each(function () {
                var productnum = $(this).children('td').eq(1).find('input').val();
                if (Number(productnum) > 0) {
                    totalCost = totalCost + Number(productnum);
                }
            });
            var cost = Math.round(totalCost * 100) / 100;
            $("#txtfreight").attr("value", cost);
            $('#txtfreight').trigger("blur");
        }


        $("#deliveryaddress").change(function () {
            //计算物流费用
            //costCalc();
            $(".shipDetailList").each(function () {
                var freightVal = $(this).children('td').eq(0).find('option:selected').val();
                var shipObj = $(this).children('td').eq(3);
                var shipCost= $(this).children('td').eq(1).find('input');
                var prodShopId = $(this).children('td').eq(4).html();
                var destId = $("#deliveryaddress").find("option:selected").val();//地址ID

                var dataObj = { "ShopId": prodShopId, "DestId": destId, "FreightType": freightVal };

                 dataObj = JSON.stringify(dataObj);

                var loading = showLoading();
                $.ajax({
                    type: 'POST',
                    url: "/Order/GetShipmentDetail",
                    contentType: "application/json; charset=utf-8",
                    data: dataObj,
                    dataType: "json",
                    success: function (data) {
                        loading.close();
                        shipCost.val(data.ShipmentCost);
                        shipObj.html(data.ShipmentValue);
                        costTotalCalc();
                    },
                    error: function (e) {
                        $.dialog.errorTips('物流配送费用计算失败');
                    }
                });

            });


            $(".feiyong").css("display", "none");
        });

        //计算费用
        //显示物流详细
        function displayShipDetail(shipStr) {

            var shipObj = JSON.parse(shipStr);

            var orgCountryCode = shipObj.OriginAddress.CountryCode

            $("#origCountry option").removeAttr("selected");

            //Set option with value 2 as selected
            // $("#origCountry option[value=orgCountryCode]").attr("selected", "selected");
            $("#origCountry").attr('value', orgCountryCode);

            $("#origCity").attr("value", shipObj.OriginAddress.City);
            $("#origPostCode").attr("value", shipObj.OriginAddress.PostalCode);
            $("#origAddress").attr("value", shipObj.OriginAddress.Line1);

            $("#destCountry option").removeAttr("selected");

            var destCountryCode = shipObj.DestinationAddress.CountryCode

            //Set option with value 2 as selected
            //$("#destCountry option[value=destCountryCode]").attr("selected", "selected");

            $("#destCountry").attr("value", destCountryCode);

            $("#destCity").attr("value", shipObj.DestinationAddress.City);
            $("#destPostCode").attr("value", shipObj.DestinationAddress.PostalCode);
            $("#destAddress").attr("value", shipObj.DestinationAddress.Line1);

            $("#packageNum").attr("value", shipObj.PackageCount);
            $("#packageWeight").attr("value", shipObj.TotalPackageWeight);



            $("#weightUnit option").removeAttr("selected");

            $("#weightUnit option[value=KG]").attr("selected", "selected");

            //加载包裹
            loadPackageGrid(shipObj.Packages);

            //加载费率
            loadGrid(shipObj.Rates);
        }

        //加载包裹grid
        function loadPackageGrid(data) {
            var tbody = $("#tablepackage_body");
            var trList = "";
            for (var i = 0; i < data.length; i++) {
                trList += "<tr ><td> " + data[i].PackageCount
                            + "</td><td>" + data[i].Weight
                            + "</td><td>" + data[i].PackageType
                            + "</td><td>" + "<span>L</span>" + "&nbsp;" + data[i].Length + "&nbsp;"
                            + "<span>W</span>" + "&nbsp;" + data[i].Width + "&nbsp;"
                             + "<span>H</span>" + "&nbsp;" + data[i].Height + "&nbsp;"
                             //+ "<span>单位</span>" + "&nbsp;" + data[i].ShipLinearUnit

                            + "</td><td>" + data[i].InsuredValue
                            + "</td></tr>";
            }
            tbody.html(trList);
        }

        //加载服务
        function loadGrid(data) {
            var tbody = $("#tableratedesc_body");
            var trList = "";
            for (var i = 0; i < data.length; i++) {
                trList += "<tr ><td> <input class='checkbox' name='shipmentRate' type='checkbox' id=" + data[i].ProviderCode + "style='margin-top:9px;' />"
                            + "</td><td>" + data[i].GurDeliveryDate
                            + "</td><td>" + data[i].Name
                            + "</td><td>" + data[i].TotalCharges
                            + "</td></tr>";
            }
            tbody.html(trList);
        }

        $(".checkbox[name=shipmentRate]").live("click", function () {

            $(':checkbox[name=shipmentRate]').each(function () {
                $(this).click(function () {
                    if ($(this).attr('checked')) {
                        $(':checkbox[name=shipmentRate]').removeAttr('checked');
                        $(this).attr('checked', 'checked');
                    }
                });
            });
        });


        $("#subFedCost").click(function () {

            $(".feiyong_a").css("display", "none");
            var tbody = document.getElementById("tableratedesc_body");
            var tab = document.getElementById("tabFedCost");

            $("#tableratedesc_body :checkbox").each(function (key, value) {
                if ($(value).attr('checked')) {
                    tab.style.display = "none";

                    if (curCostObj != null) {
                        curCostObj.attr("value", tbody.rows[key].cells[3].innerHTML);
                        costTotalCalc();
                    }
                    //$("#txtfreight").attr("value", tbody.rows[key].cells[3].innerHTML);
                    //$('#txtfreight').trigger("blur");

                }
            })

        });
    });
</script>


<input type="hidden" id="hdInsurancefeeMaxValue" value="@ViewBag.InsurancefeeMaxValue" />


<script>
    /*正则验证价格*/
    var regprice = /^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$/;
    /*正则验证数量*/
    var regnum = /^\+?[1-9][0-9]*$/;

    $(function () {
        //提交定单
        $("#submitmargain").click(function () {

            /*发票信息*/
            var InvoiceType = "0", InvoiceTitle = "", InvoiceContext = "", SellerPhone = "", SellerRemark = "", SellerAddress = "";
            if ($("#cbinvoice").attr("checked") == "checked") {
                if ($.trim($("#txtinvoicename").val()) == "") {
                    $.dialog.errorTips('请填写发票名称！');
                    return false;
                }
                InvoiceType = $("#invoicetype").val();//发票类型
                InvoiceTitle = $.trim($("#txtinvoicename").val());//名称
                InvoiceContext = $.trim($("#txttaxpayeridentificationnumber").val());//纳税人识别号
                SellerPhone = $.trim($("#txtcallnumber").val())//电话
                SellerRemark = $.trim($("#txtbankaccount").val())//开户行及账号
                SellerAddress = $("#incoiceaddress").find("option:selected").text()//地址
            }
            /*保险费*/
            var IsInsurance = "0";
            var Insurancefee = "0";
            if ($("#cbinsurance").attr("checked") == "checked") {
                IsInsurance = "1";
                Insurancefee = $.trim($(".insurancefee").html());
            }

            var distributiontype = $("#freighttype").val();//物流配送方式
            var distributiontype = "";
            var distributioncost = $.trim($("#txtfreight").val());//物流配送费用
            var regionid = $("#deliveryaddress").val(); //地址Id
            var deliveryaddress = $("#deliveryaddress").find("option:selected").text();
            var deliverydate = "2016-06-20"; //发货时间

            var prodcutcointypename = "CNY";

            var shipment = "";//物流相关
            var cointype = 1;
            if (distributioncost == "" || distributioncost == null) {
                $.dialog.errorTips("您还未填写物流配送费用！");
                return false;
            }
            if (!regprice.test(distributioncost)) {
                $.dialog.errorTips('物流配送费用必须为数字！');
                return false;
            }

            if (deliveryaddress == "请选择收货地址" || deliveryaddress == null) {
                $.dialog.errorTips("您还未设置收货地址！");
                return false;
            }
            var jsonbill = "";
            jsonbill += "{";
            jsonbill += "\"BillNo\":\"0\",";
            jsonbill += "\"ShopId\":\"0\",";
            jsonbill += "\"DeliverType\":\"" + distributiontype + "\",";
            jsonbill += "\"DeliverCost\":\"" + distributioncost + "\",";
            jsonbill += "\"DeliverDate\":\"" + deliverydate + "\",";
            jsonbill += "\"RegionId\":\"" + regionid + "\",";
            jsonbill += "\"DeliverAddress\":\"" + deliveryaddress + "\",";
            jsonbill += "\"PayMode\":\"\",";
            jsonbill += "\"IsInsurance\":\"" + IsInsurance + "\",";
            jsonbill += "\"Insurancefee\":\"" + Insurancefee + "\",";
            jsonbill += "\"InvoiceType\":\"" + InvoiceType + "\",";
            jsonbill += "\"InvoiceTitle\":\"" + InvoiceTitle + "\",";
            jsonbill += "\"InvoiceContext\":\"" + InvoiceContext + "\",";
            jsonbill += "\"SellerPhone\":\"" + SellerPhone + "\",";
            jsonbill += "\"SellerRemark\":\"" + SellerRemark + "\",";
            jsonbill += "\"SellerAddress\":\"" + SellerAddress + "\",";
            jsonbill += "\"_MargainBillDetail\":[";
            jsonbill += "{";
            jsonbill += "\"BillNo\":\"0\",";
            jsonbill += "\"ProductId\":\"0\",";
            jsonbill += "\"ProductName\":\"0\",";
            jsonbill += "\"Num\":\"0\",";
            jsonbill += "\"MarketPrice\":\"0\",";
            jsonbill += "\"PurchasePrice\":\"0\",";
            jsonbill += "\"CoinType\":\"0\",";
            jsonbill += "\"PackingUnit\":\"0\",";
            jsonbill += "\"SpecLevel\":\"0\",";
            jsonbill += "\"Purity\":\"0\"";
            jsonbill += "},";
            jsonbill = jsonbill.substring(0, jsonbill.length - 1);
            jsonbill += "]}";


            //供应商物流信息
            var shopDeliver = "";
            var prodShopType = null;
            var prodShopPrice = null;
            var prodShopId = null;
            shopDeliver += "{";
            shopDeliver += "\"Shops\":[";
            $(".shipDetailList").each(function () {
                prodShopType = $(this).children('td').eq(0).find('select').val();
                prodShopPrice = $(this).children('td').eq(1).find('input').val();
                prodShopId = $(this).children('td').eq(4).html();
                if (Number(prodShopId) > 0) {
                    shopDeliver += "{";
                    shopDeliver += "\"ShopId\":\"" + Number(prodShopId) + "\",";
                    shopDeliver += "\"DeliverType\":\"" + prodShopType + "\",";
                    shopDeliver += "\"DeliverCost\":\"" + prodShopPrice + "\",";
                    shopDeliver += "},";
                }
            });

            shopDeliver = shopDeliver.substring(0, jsonbill.length - 1);
            shopDeliver += "]}";

            var jsonModel = {
                "Bill": jsonbill,
                "Ship": shopDeliver
            };

            jsonModel = JSON.stringify(jsonModel);

            $.dialog.confirm('确定提交订单？', function () {
                var loading = showLoading();
                $.post('/Order/SubmitOrderBatchFun', { json: jsonModel },
                    function (data) {
                        loading.close();
                        if (data.success) {
                            $.dialog.succeedTips("提交成功！", function () {
                                showLoading();
                                location.href = "/userCenter/Index?orderlist=1";
                            }, 3);
                        }
                        else {
                            $.dialog.errorTips("提交失败！");
                        }
                    });
            });
        });

        if ($("#deliveryaddress").val() == null) {
            self.setInterval(function () {
                $.post('/Bargain/GetAddress', function (data) {
                    if (data.success) {
                        var htmls = "";
                        $.each($.parseJSON(data.msg), function (i, item) {
                            htmls = htmls + "<option value='" + item.Id + "'>" + item.RegionFullName + ">" + item.Address + "</option>";
                        });
                        $("#deliveryaddress").html(htmls);
                    }
                });
            }, 2000);
        }

        var producttotalamount = 0;
        $(".price").each(function () {
            var $value = $(this).html();
            producttotalamount = producttotalamount + Number($value);
        });

        $(".insurancefee").html(Number(producttotalamount * Number($("#hdInsurancefeeMaxValue").val()) * 0.01).toFixed(2));
        $(".orderamount").html(Number(producttotalamount).toFixed(2));


        //txtfreight
        $("#txtfreight").live("blur", function () {
            var $value = $.trim($("#txtfreight").val());
            if ($value == "") { $.dialog.errorTips('请填写物流配送费用！'); } else {
                if ($value != "0") {
                    if (!regprice.test($value)) {
                        $.dialog.errorTips('物流配送费用必须为数字！');
                        return false;
                    } else {
                        var freight = 0;
                        if ($.trim($("#txtfreight").val()) != "") { freight = $.trim($("#txtfreight").val()); }
                        var pamount = 0;
                        $(".price").each(function () {
                            pamount = pamount + Number($(this).html());
                        });
                        var insurancefee = 0;
                        if ($("#cbinsurance").attr("checked") == "checked") { insurancefee = $.trim($(".insurancefee").html()); }
                        $(".orderamount").html((Number(freight) + Number(pamount) + Number(insurancefee)).toFixed(2));
                    }
                } else {
                    var freight = 0;
                    if ($.trim($("#txtfreight").val()) != "") { freight = $.trim($("#txtfreight").val()); }
                    var pamount = 0;
                    $(".price").each(function () {
                        pamount = pamount + Number($(this).html());
                    });
                    var insurancefee = 0;
                    if ($("#cbinsurance").attr("checked") == "checked") { insurancefee = $.trim($(".insurancefee").html()); }
                    $(".orderamount").html((Number(freight) + Number(pamount) + Number(insurancefee)).toFixed(2));
                }
            }
        });

        //cbinsurance
        $("#cbinsurance").click(function () {
            if (Number($.trim($(".insurancefee").html())) > 0) {
                if ($(this).attr('checked')) {
                    $(".orderamount").html((Number($(".orderamount").html()) + Number($.trim($(".insurancefee").html()))).toFixed(2));
                } else {
                    $(".orderamount").html((Number($(".orderamount").html()) - Number($.trim($(".insurancefee").html()))).toFixed(2));
                }
            }
        });


        //invoicetr
        $(".invoicetr").attr("disabled", "disabled");
        $("#invoicetype").click(function () {
            var $value = $(this).val();
            if ($value == "3") {
                $(".invoicetr").removeAttr("disabled");
            } else { $(".invoicetr").attr("disabled", "disabled"); }
        });
    })
</script>